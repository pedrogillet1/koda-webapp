generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model action_history {
  id           String   @id @default(uuid())
  userId       String
  actionType   String
  targetPath   String
  previousPath String?
  fileContent  String?
  fileType     String?
  canUndo      Boolean  @default(true)
  canRedo      Boolean  @default(false)
  timestamp    DateTime @default(now())
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([canRedo])
  @@index([canUndo])
  @@index([timestamp])
  @@index([userId])
}

model analysis_sessions {
  id                String              @id @default(uuid())
  userId            String
  sessionType       String              @default("document_analysis")
  status            String              @default("active")
  documentCount     Int                 @default(0)
  documentIds       String?
  createdAt         DateTime            @default(now())
  expiresAt         DateTime
  completedAt       DateTime?
  session_documents session_documents[]

  @@index([expiresAt])
  @@index([status])
  @@index([userId])
}

model api_keys {
  id          String    @id @default(uuid())
  userId      String
  name        String
  keyHash     String    @unique
  keyPreview  String
  scopes      String
  expiresAt   DateTime?
  lastUsedAt  DateTime?
  isActive    Boolean   @default(true)
  rateLimit   Int       @default(1000)
  usageCount  Int       @default(0)
  windowStart DateTime  @default(now())
  ipWhitelist String?
  userAgent   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([keyHash])
  @@index([userId])
}

model api_usage {
  id                String   @id @default(uuid())
  userId            String
  month             String
  geminiTokensUsed  Int      @default(0)
  embeddingRequests Int      @default(0)
  chatRequests      Int      @default(0)
  costUSD           Float    @default(0.0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@unique([userId, month])
  @@index([month])
  @@index([userId])
}

model audit_logs {
  id        String   @id @default(uuid())
  userId    String?
  action    String
  resource  String?
  ipAddress String?
  userAgent String?
  status    String
  details   String?
  createdAt DateTime @default(now())
  users     users?   @relation(fields: [userId], references: [id])

  @@index([action])
  @@index([createdAt])
  @@index([userId])
}

model categories {
  id                  String                @id @default(uuid())
  userId              String
  name                String
  description         String?
  color               String?
  icon                String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime @updatedAt
  document_categories document_categories[]

  @@unique([userId, name])
  @@index([userId])
}

model causal_relationships {
  id                String   @id @default(uuid())
  userId            String
  effect            String
  causes            String
  evidence          String?
  context           String?
  mechanism         String?
  domain            String?
  causalType        String?
  sourceDocumentIds String?
  documentCount     Int      @default(1)
  extractedPatterns String?
  confidence        Float    @default(0.5)
  isVerified        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([confidence])
  @@index([userId, domain])
  @@index([userId])
}

model chat_contexts {
  id              String        @id @default(uuid())
  conversationId  String
  messageId       String?
  sourceDocuments String
  webSources      String?
  searchQuery     String?
  expandedTerms   String?
  createdAt       DateTime      @default(now())
  conversations   conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([messageId])
}

model chat_documents {
  id               String    @id @default(uuid())
  messageId        String
  conversationId   String
  userId           String
  title            String
  markdownContent  String
  documentType     String?
  sourceDocumentId String?
  pdfUrl           String?
  docxUrl          String?
  wordCount        Int?
  createdAt        DateTime  @default(now())
  expiresAt        DateTime?
  messages         messages  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([expiresAt])
  @@index([messageId])
  @@index([userId])
}

model cloud_integrations {
  id             String    @id @default(uuid())
  userId         String
  provider       String
  accessToken    String
  refreshToken   String?
  tokenExpiry    DateTime?
  providerUserId String?
  providerEmail  String?
  isActive       Boolean   @default(true)
  lastSyncedAt   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime @updatedAt
  users          users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider])
  @@index([userId])
}

model comparative_data {
  id                    String   @id @default(uuid())
  userId                String
  conceptA              String
  conceptB              String
  attributes            String
  comparativeStatements String?
  keyInsight            String?
  similarities          String?
  differences           String?
  sourceDocumentIds     String?
  documentCount         Int      @default(1)
  confidence            Float    @default(0.5)
  isVerified            Boolean  @default(false)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@unique([userId, conceptA, conceptB])
  @@index([conceptA])
  @@index([conceptB])
  @@index([userId])
}

model concept_relationships {
  id                                                                     String           @id @default(uuid())
  userId                                                                 String
  fromConceptId                                                          String
  toConceptId                                                            String
  relationshipType                                                       String
  strength                                                               Float            @default(0.5)
  description                                                            String?
  sourceDocumentIds                                                      String?
  documentCount                                                          Int              @default(1)
  createdAt                                                              DateTime         @default(now())
  domain_knowledge_concept_relationships_fromConceptIdTodomain_knowledge domain_knowledge @relation("concept_relationships_fromConceptIdTodomain_knowledge", fields: [fromConceptId], references: [id], onDelete: Cascade)
  domain_knowledge_concept_relationships_toConceptIdTodomain_knowledge   domain_knowledge @relation("concept_relationships_toConceptIdTodomain_knowledge", fields: [toConceptId], references: [id], onDelete: Cascade)

  @@unique([fromConceptId, toConceptId, relationshipType])
  @@index([fromConceptId])
  @@index([relationshipType])
  @@index([toConceptId])
  @@index([userId])
}

model conversation_summaries {
  id             String   @id @default(uuid())
  userId         String
  conversationId String
  summary        String
  userMessages   String[]
  timestamp      DateTime
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, timestamp])
}

model conversation_topics {
  id           String   @id @default(uuid())
  userId       String
  topicSummary String
  firstSeen    DateTime
  lastSeen     DateTime
  frequency    Int      @default(1)
  confidence   Float    @default(0.5)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, lastSeen])
}

model conversations {
  id                String          @id @default(uuid())
  userId            String
  title             String          @default("New Chat")
  createdAt         DateTime        @default(now())
  updatedAt         DateTime @updatedAt
  titleEncrypted    String?
  encryptionSalt    String?
  encryptionIV      String?
  encryptionAuthTag String?
  contextType       String?
  contextId         String?
  contextName       String?
  contextMeta       Json?
  scopeDescription  String?
  scopeDocumentIds  String[]        @default([])
  chat_contexts     chat_contexts[]
  users             users           @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages          messages[]

  @@index([contextType, contextId])
  @@index([userId])
  @@index([userId, updatedAt])
}

model document_categories {
  id         String     @id @default(uuid())
  documentId String
  categoryId String
  createdAt  DateTime   @default(now())
  categories categories @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  documents  documents  @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@unique([documentId, categoryId])
  @@index([categoryId])
  @@index([documentId])
}

model document_edit_history {
  id                  String              @id @default(uuid())
  generatedDocumentId String
  editNumber          Int
  editType            String
  editCommand         String?
  editDescription     String
  contentBefore       String
  contentAfter        String
  editedBy            String
  editedAt            DateTime            @default(now())
  generated_documents generated_documents @relation(fields: [generatedDocumentId], references: [id], onDelete: Cascade)

  @@index([editNumber])
  @@index([editedBy])
  @@index([generatedDocumentId])
}

model document_embeddings {
  id         String    @id @default(uuid())
  documentId String
  chunkIndex Int
  content    String
  embedding  String
  metadata   String
  createdAt  DateTime  @default(now())
  documents  documents @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId, chunkIndex])
  @@index([documentId])
}

model document_entities {
  id              String   @id @default(uuid())
  documentId      String
  entityType      String
  value           String
  normalizedValue String
  pageNumber      Int
  textIndex       Int
  context         String
  metadata        String?
  createdAt       DateTime @default(now())

  @@index([documentId, entityType])
  @@index([documentId])
  @@index([entityType])
  @@index([normalizedValue])
  @@index([value])
}

model document_keywords {
  id         String   @id @default(uuid())
  documentId String
  word       String
  count      Int
  createdAt  DateTime @default(now())

  @@index([documentId])
  @@index([word])
}

model document_metadata {
  id                    String    @id @default(uuid())
  documentId            String    @unique
  extractedText         String?
  ocrConfidence         Float?
  pageCount             Int?
  wordCount             Int?
  characterCount        Int?
  thumbnailUrl          String?
  entities              String?
  classification        String?
  summary               String?
  author                String?
  creationDate          DateTime?
  modificationDate      DateTime?
  language              String?
  topics                String?
  keyEntities           String?
  hasSignature          Boolean   @default(false)
  hasTables             Boolean   @default(false)
  hasImages             Boolean   @default(false)
  markdownContent       String?
  markdownUrl           String?
  markdownStructure     String?
  sheetCount            Int?
  slideCount            Int?
  slidesData            String?
  pptxMetadata          String?
  slideGenerationStatus String?   @default("pending")
  slideGenerationError  String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime @updatedAt
  documents             documents @relation(fields: [documentId], references: [id], onDelete: Cascade)
}

model document_shares {
  id                                        String    @id @default(uuid())
  documentId                                String
  ownerId                                   String
  sharedWithId                              String
  permissionLevel                           String    @default("viewer")
  canDownload                               Boolean   @default(true)
  canShare                                  Boolean   @default(false)
  canDelete                                 Boolean   @default(false)
  expiresAt                                 DateTime?
  createdAt                                 DateTime  @default(now())
  updatedAt                                 DateTime @updatedAt
  users_document_shares_ownerIdTousers      users     @relation("document_shares_ownerIdTousers", fields: [ownerId], references: [id], onDelete: Cascade)
  users_document_shares_sharedWithIdTousers users     @relation("document_shares_sharedWithIdTousers", fields: [sharedWithId], references: [id], onDelete: Cascade)

  @@unique([documentId, sharedWithId])
  @@index([documentId])
  @@index([ownerId])
  @@index([sharedWithId])
}

model document_summaries {
  id          String    @id @default(uuid())
  documentId  String
  summary     String
  summaryType String    @default("standard")
  createdAt   DateTime  @default(now())
  documents   documents @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
}

model document_tags {
  id         String    @id @default(uuid())
  documentId String
  tagId      String
  createdAt  DateTime  @default(now())
  documents  documents @relation(fields: [documentId], references: [id], onDelete: Cascade)
  tags       tags      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([documentId, tagId])
  @@index([documentId])
  @@index([tagId])
}

model document_templates {
  id                  String                @id @default(uuid())
  userId              String?
  name                String
  description         String?
  category            String
  structure           String
  isSystem            Boolean               @default(false)
  usageCount          Int                   @default(0)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime @updatedAt
  generated_documents generated_documents[]

  @@index([category])
  @@index([isSystem])
  @@index([userId])
}

model documents {
  id                     String                @id @default(uuid())
  userId                 String
  folderId               String?
  filename               String
  encryptedFilename      String
  fileSize               Int
  mimeType               String
  fileHash               String
  status                 String                @default("processing")
  parentVersionId        String?
  isEncrypted            Boolean               @default(false)
  encryptionSalt         String?
  encryptionIV           String?
  encryptionAuthTag      String?
  filenameEncrypted      String?
  extractedTextEncrypted String?
  renderableContent      String?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime @updatedAt
  document_categories    document_categories[]
  document_embeddings    document_embeddings[]
  document_metadata      document_metadata?
  document_summaries     document_summaries[]
  document_tags          document_tags[]
  folders                folders?              @relation(fields: [folderId], references: [id], onDelete: Cascade)
  documents              documents?            @relation("documentsTodocuments", fields: [parentVersionId], references: [id])
  other_documents        documents[]           @relation("documentsTodocuments")
  users                  users                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  generated_documents    generated_documents?

  @@index([fileHash])
  @@index([filename])
  @@index([folderId])
  @@index([folderId, status])
  @@index([mimeType])
  @@index([parentVersionId])
  @@index([status])
  @@index([userId, createdAt])
  @@index([userId, fileHash, filename])
  @@index([userId, filename])
  @@index([userId, folderId, status])
  @@index([userId])
  @@index([userId, status])
  @@index([userId, updatedAt])
}

model domain_knowledge {
  id                                                                          String                  @id @default(uuid())
  userId                                                                      String
  term                                                                        String
  normalizedTerm                                                              String
  domain                                                                      String
  definition                                                                  String?
  formula                                                                     String?
  interpretation                                                              String?
  usageContext                                                                String?
  examples                                                                    String?
  relatedTerms                                                                String?
  parentTerm                                                                  String?
  childTerms                                                                  String?
  synonyms                                                                    String?
  sourceDocumentIds                                                           String?
  documentCount                                                               Int                     @default(1)
  extractedContext                                                            String?
  confidence                                                                  Float                   @default(0.5)
  isVerified                                                                  Boolean                 @default(false)
  createdAt                                                                   DateTime                @default(now())
  updatedAt                                                                   DateTime @updatedAt
  lastAccessedAt                                                              DateTime                @default(now())
  accessCount                                                                 Int                     @default(0)
  concept_relationships_concept_relationships_fromConceptIdTodomain_knowledge concept_relationships[] @relation("concept_relationships_fromConceptIdTodomain_knowledge")
  concept_relationships_concept_relationships_toConceptIdTodomain_knowledge   concept_relationships[] @relation("concept_relationships_toConceptIdTodomain_knowledge")
  users                                                                       users                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, normalizedTerm, domain])
  @@index([domain])
  @@index([normalizedTerm])
  @@index([term])
  @@index([userId, domain])
  @@index([userId])
}

model excel_cells {
  id           String       @id @default(uuid())
  sheetId      String
  rowIndex     Int
  colIndex     Int
  value        String?
  formula      String?
  dataType     String
  style        String?
  cachedAt     DateTime     @default(now())
  excel_sheets excel_sheets @relation(fields: [sheetId], references: [id], onDelete: Cascade)

  @@unique([sheetId, rowIndex, colIndex])
  @@index([sheetId])
}

model excel_sheets {
  id          String        @id @default(uuid())
  documentId  String
  sheetIndex  Int
  sheetName   String
  rowCount    Int
  columnCount Int
  metadata    String?
  cachedAt    DateTime      @default(now())
  expiresAt   DateTime
  excel_cells excel_cells[]

  @@unique([documentId, sheetIndex])
  @@index([documentId])
  @@index([expiresAt])
}

model folder_summaries {
  id                  String    @id @default(uuid())
  folderId            String    @unique
  userId              String
  summary             String
  documentCount       Int
  themes              String[]  @default([])
  lastDocumentAddedAt DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime @updatedAt

  @@index([folderId])
  @@index([userId])
}

model folders {
  id                String      @id @default(uuid())
  userId            String
  name              String
  description       String?
  emoji             String?
  color             String?
  parentFolderId    String?
  path              String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime @updatedAt
  nameEncrypted     String?
  encryptionSalt    String?
  encryptionIV      String?
  encryptionAuthTag String?
  documents         documents[]
  folders           folders?    @relation("foldersTofolders", fields: [parentFolderId], references: [id], onDelete: Cascade)
  other_folders     folders[]   @relation("foldersTofolders")
  users             users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([parentFolderId])
  @@index([parentFolderId, name])
  @@index([path])
  @@index([userId])
  @@index([userId, parentFolderId])
}

model generated_documents {
  id                    String                  @id @default(uuid())
  userId                String
  documentId            String                  @unique
  generationType        String
  conversationId        String?
  isTemporary           Boolean                 @default(true)
  expiresAt             DateTime?
  sourceDocumentIds     String
  generationPrompt      String?
  templateId            String?
  renderableContent     String
  metadata              String?
  generatedAt           DateTime                @default(now())
  savedAt               DateTime?
  document_edit_history document_edit_history[]
  documents             documents               @relation(fields: [documentId], references: [id], onDelete: Cascade)
  document_templates    document_templates?     @relation(fields: [templateId], references: [id])

  @@index([conversationId])
  @@index([documentId])
  @@index([expiresAt])
  @@index([generationType])
  @@index([isTemporary])
  @@index([templateId])
  @@index([userId])
}

model interaction_metadata {
  id            String   @id @default(uuid())
  userId        String
  metadataType  String
  metadataValue String
  updatedAt     DateTime @updatedAt
  users         users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, metadataType])
  @@index([userId])
}

model knowledge_entries {
  id         String   @id @default(uuid())
  documentId String
  type       String
  content    String
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([documentId])
  @@index([documentId, type])
  @@index([type])
}

model memories {
  id           String        @id @default(uuid())
  userId       String
  section      MemorySection
  content      String
  importance   Int           @default(5)
  createdAt    DateTime      @default(now())
  lastAccessed DateTime      @default(now())
  accessCount  Int           @default(0)
  source       String?
  metadata     Json?
  users        users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([lastAccessed])
  @@index([userId, importance])
  @@index([userId, section])
}

model message_attachments {
  id                String   @id @default(uuid())
  messageId         String
  conversationId    String
  userId            String
  attachmentType    String
  title             String
  content           String
  previewHtml       String?
  previewCss        String?
  sourceDocumentIds String?
  analysisType      String?
  metadata          String?
  editHistory       String?
  editCount         Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  messages          messages @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([attachmentType])
  @@index([conversationId])
  @@index([messageId])
  @@index([userId])
}

model messages {
  id                  String                @id @default(uuid())
  conversationId      String
  role                String
  content             String
  metadata            String?
  createdAt           DateTime              @default(now())
  isEncrypted         Boolean               @default(false)
  encryptionSalt      String?
  encryptionIV        String?
  encryptionAuthTag   String?
  isDocument          Boolean               @default(false)
  documentTitle       String?
  documentFormat      String?
  markdownContent     String?
  calculationResult   Json?
  contextEntities     Json?
  chat_documents      chat_documents[]
  message_attachments message_attachments[]
  conversations       conversations         @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@index([conversationId])
  @@index([isDocument])
}

model methodology_knowledge {
  id                String   @id @default(uuid())
  userId            String
  name              String
  aliases           String?
  definition        String?
  howItWorks        String?
  whyUsed           String?
  limitations       String?
  useCases          String?
  examples          String?
  relatedMethods    String?
  parentMethod      String?
  childMethods      String?
  sourceDocumentIds String?
  documentCount     Int      @default(1)
  extractedFrom     String?
  confidence        Float    @default(0.5)
  isVerified        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  lastAccessedAt    DateTime @default(now())
  accessCount       Int      @default(0)

  @@unique([userId, name])
  @@index([confidence])
  @@index([documentCount])
  @@index([name])
  @@index([userId])
  @@index([userId, name])
}

model notifications {
  id                String     @id @default(uuid())
  userId            String
  type              String
  title             String
  message           String
  relatedDocumentId String?
  relatedReminderId String?
  isRead            Boolean    @default(false)
  createdAt         DateTime   @default(now())
  reminders         reminders? @relation(fields: [relatedReminderId], references: [id])
  users             users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId, isRead])
}

model pending_users {
  id                 String   @id @default(uuid())
  email              String   @unique
  passwordHash       String
  salt               String
  firstName          String?
  lastName           String?
  phoneNumber        String?
  emailCode          String?
  phoneCode          String?
  emailVerified      Boolean  @default(false)
  phoneVerified      Boolean  @default(false)
  expiresAt          DateTime
  createdAt          DateTime @default(now())
  recoveryKeyHash    String?
  masterKeyEncrypted String?

  @@index([email])
}

model permissions {
  id               String             @id @default(uuid())
  resource         String
  action           String
  description      String?
  createdAt        DateTime           @default(now())
  role_permissions role_permissions[]

  @@unique([resource, action])
  @@index([resource])
}

model practical_recommendations {
  id                String   @id @default(uuid())
  userId            String
  recommendation    String
  category          String
  strength          String
  evidence          String?
  rationale         String?
  thresholds        String?
  domain            String?
  applicability     String?
  sourceDocumentIds String?
  documentCount     Int      @default(1)
  consensusLevel    String?
  confidence        Float    @default(0.5)
  isVerified        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([category])
  @@index([consensusLevel])
  @@index([strength])
  @@index([userId, category])
  @@index([userId])
}

model reminders {
  id            String          @id @default(uuid())
  userId        String
  title         String
  description   String?
  dueDate       DateTime
  isCompleted   Boolean         @default(false)
  notified      Boolean         @default(false)
  documentId    String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime @updatedAt
  notifications notifications[]
  users         users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([userId])
}

model role_hierarchy {
  id                                       String   @id @default(uuid())
  parentRoleId                             String
  childRoleId                              String
  createdAt                                DateTime @default(now())
  roles_role_hierarchy_childRoleIdToroles  roles    @relation("role_hierarchy_childRoleIdToroles", fields: [childRoleId], references: [id], onDelete: Cascade)
  roles_role_hierarchy_parentRoleIdToroles roles    @relation("role_hierarchy_parentRoleIdToroles", fields: [parentRoleId], references: [id], onDelete: Cascade)

  @@unique([parentRoleId, childRoleId])
  @@index([childRoleId])
  @@index([parentRoleId])
}

model role_permissions {
  id           String      @id @default(uuid())
  roleId       String
  permissionId String
  createdAt    DateTime    @default(now())
  permissions  permissions @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  roles        roles       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([permissionId])
  @@index([roleId])
}

model roles {
  id                                                String             @id @default(uuid())
  name                                              String             @unique
  description                                       String?
  priority                                          Int                @default(0)
  isSystem                                          Boolean            @default(false)
  createdAt                                         DateTime           @default(now())
  updatedAt                                         DateTime @updatedAt
  role_hierarchy_role_hierarchy_childRoleIdToroles  role_hierarchy[]   @relation("role_hierarchy_childRoleIdToroles")
  role_hierarchy_role_hierarchy_parentRoleIdToroles role_hierarchy[]   @relation("role_hierarchy_parentRoleIdToroles")
  role_permissions                                  role_permissions[]
  user_roles                                        user_roles[]

  @@index([name])
  @@index([priority])
}

model session_documents {
  id                String            @id @default(uuid())
  sessionId         String
  userId            String
  filename          String
  fileSize          Int
  mimeType          String
  fileType          String
  status            String            @default("processing")
  extractedText     String?
  wordCount         Int?
  pageCount         Int?
  uploadedAt        DateTime          @default(now())
  processedAt       DateTime?
  analysis_sessions analysis_sessions @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([status])
  @@index([userId])
}

model sessions {
  id               String   @id @default(uuid())
  userId           String
  refreshTokenHash String
  expiresAt        DateTime
  createdAt        DateTime @default(now())
  lastActivityAt   DateTime @default(now())
  ipAddress        String?
  lastIpAddress    String?
  userAgent        String?
  deviceId         String?
  deviceType       String?
  deviceName       String?
  isActive         Boolean  @default(true)
  isSuspicious     Boolean  @default(false)
  suspicionReason  String?
  country          String?
  city             String?
  users            users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([isActive])
  @@index([userId])
}

model tags {
  id            String          @id @default(uuid())
  userId        String
  name          String
  color         String?
  createdAt     DateTime        @default(now())
  document_tags document_tags[]
  users         users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name])
  @@index([userId])
}

model terminology_maps {
  id        String   @id @default(uuid())
  userId    String
  term      String
  synonyms  String
  domain    String
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, term, domain])
  @@index([domain])
  @@index([term])
  @@index([userId])
}

model trend_patterns {
  id                String   @id @default(uuid())
  userId            String
  subject           String
  trendType         String
  timeframe         String?
  description       String
  dataPoints        String?
  magnitude         String?
  drivers           String?
  implications      String?
  sourceDocumentIds String?
  documentCount     Int      @default(1)
  confidence        Float    @default(0.5)
  isVerified        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([subject])
  @@index([trendType])
  @@index([userId])
  @@index([userId, trendType])
}

model two_factor_auth {
  id          String   @id @default(uuid())
  userId      String   @unique
  secret      String
  backupCodes String
  isEnabled   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_insights {
  id          String   @id @default(uuid())
  userId      String
  insightType String
  insightText String
  confidence  Float    @default(0.5)
  evidence    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, insightType])
}

model user_preferences {
  id                        String   @id @default(uuid())
  userId                    String   @unique
  emailNotificationsEnabled Boolean  @default(true)
  emailNotificationTypes    String?
  notificationFrequency     String   @default("immediate")
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  users                     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_preferences_memory {
  id              String   @id @default(uuid())
  userId          String
  preferenceType  String
  preferenceValue String
  confidence      Float    @default(0.5)
  evidence        String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  users           users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, preferenceType])
}

model user_profiles {
  id             String   @id @default(uuid())
  userId         String   @unique
  name           String?
  role           String?
  organization   String?
  expertiseLevel String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model user_roles {
  id        String    @id @default(uuid())
  userId    String
  roleId    String
  grantedBy String?
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  roles     roles     @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([roleId])
  @@index([userId])
}

model users {
  id                                                  String                    @id @default(uuid())
  email                                               String                    @unique
  firstName                                           String?
  lastName                                            String?
  profileImage                                        String?
  passwordHash                                        String?
  salt                                                String?
  googleId                                            String?                   @unique
  appleId                                             String?                   @unique
  phoneNumber                                         String?                   @unique
  isEmailVerified                                     Boolean                   @default(false)
  isPhoneVerified                                     Boolean                   @default(false)
  subscriptionTier                                    String                    @default("free")
  role                                                String                    @default("user")
  storageUsedBytes                                    BigInt                    @default(0)
  createdAt                                           DateTime                  @default(now())
  updatedAt                                           DateTime @updatedAt
  recoveryKeyHash                                     String?
  masterKeyEncrypted                                  String?
  action_history                                      action_history[]
  audit_logs                                          audit_logs[]
  cloud_integrations                                  cloud_integrations[]
  conversation_summaries                              conversation_summaries[]
  conversation_topics                                 conversation_topics[]
  conversations                                       conversations[]
  document_shares_document_shares_ownerIdTousers      document_shares[]         @relation("document_shares_ownerIdTousers")
  document_shares_document_shares_sharedWithIdTousers document_shares[]         @relation("document_shares_sharedWithIdTousers")
  documents                                           documents[]
  domain_knowledge                                    domain_knowledge[]
  folders                                             folders[]
  interaction_metadata                                interaction_metadata[]
  memories                                            memories[]
  notifications                                       notifications[]
  reminders                                           reminders[]
  sessions                                            sessions[]
  tags                                                tags[]
  terminology_maps                                    terminology_maps[]
  two_factor_auth                                     two_factor_auth?
  user_insights                                       user_insights[]
  user_preferences                                    user_preferences?
  user_preferences_memory                             user_preferences_memory[]
  user_profiles                                       user_profiles?
  verification_codes                                  verification_codes[]
}

model verification_codes {
  id        String   @id @default(uuid())
  userId    String
  type      String
  code      String
  expiresAt DateTime
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([userId])
}

enum MemorySection {
  USER_PREFERENCES
  WORK_CONTEXT
  PERSONAL_FACTS
  GOALS
  COMMUNICATION_STYLE
  RELATIONSHIPS
}
