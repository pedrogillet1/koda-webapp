  private detectDomain(query: string): QueryDomain {
    const lowerQuery = query.toLowerCase();

    // If query mentions specific document/file, it's doc_content (takes priority)
    if (/no arquivo|in the file|in file|no documento|from the document/i.test(query)) {
      return 'doc_content';
    }

    // Category 14: META_AI (check before analytics to avoid false positives)
    if (this.hasKeywords(query, META_AI_KEYWORDS)) {
      return 'meta_ai';
    }

    // Category 13: CHITCHAT
    if (this.hasKeywords(query, CHITCHAT_KEYWORDS)) {
      return 'chitchat';
    }

    // Category 2: DOC_ANALYTICS - only for actual analytics about document collection
    const analyticsPatterns = [
      /quantos (documentos|arquivos|pdfs)/i,
      /how many (documents|files|pdfs)/i,
      /cuÃ¡ntos (documentos|archivos)/i,
      /liste (meus |os |todos )?(documentos|arquivos)/i,
      /list (my |all |the )?(documents|files)/i,
      /meus documentos/i,
      /my documents/i,
    ];
    if (analyticsPatterns.some(p => p.test(lowerQuery))) {
      return 'analytics';
    }

    // Category 1: DOC_QA (default for document questions)
    return 'doc_content';
  }
